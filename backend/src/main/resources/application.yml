spring:
  config:
    import: optional:file:.env[.properties],optional:file:backend/.env[.properties]
  application:
    name: blog
  profiles:
    default: dev

  jpa:
    hibernate:
      ddl-auto: update
    properties:
      hibernate:
        jdbc:
          time_zone: UTC
        format_sql: true
    show-sql: false

  servlet:
    multipart:
      max-file-size: -1
      max-request-size: -1

logging:
  level:
    org:
      hibernate:
        SQL: warn
    org.springframework.web: INFO

security:
  jwt:
    access-valid-seconds: 1800
    refresh-valid-seconds: 1209600
    cookie:
      domain: ""
      secure: false
      same-site: Lax
    secret-base64: Rm9vQmFyS2V5X0Rldl9PTkxZX0RvX05PVF9VU0VfVGhpc19pcy1Kb3N0X2FuX2V4YW1wbGVfc2VjcmV0XzEyMzQ1Njc4OTA=

app:
  admin:
    email: admin@example.com
    password: admin1234!
    nickname: "???"
  google:
    client-id: 577653110613-dqcpoe7qkjacdsosrb0namlrfuvsm26m.apps.googleusercontent.com

server:
  forward-headers-strategy: framework
  port: 8081

gemini:
  api-key: ${GEMINI_API_KEY:}

# Actuator 설정 (Health Check & Monitoring)
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
      base-path: /actuator
  endpoint:
    health:
      show-details: when-authorized
  metrics:
    tags:
      application: ${spring.application.name}

# ==================================================
# ================= DEV (H2) =======================
# ==================================================
---
spring:
  config:
    activate:
      on-profile: dev

  datasource:
    url: jdbc:h2:mem:myproject;MODE=MySQL;DB_CLOSE_DELAY=-1;DATABASE_TO_UPPER=false
    driver-class-name: org.h2.Driver
    username: sa
    password:

  h2:
    console:
      enabled: true
      path: /h2-console
      settings:
        web-allow-others: true

  jpa:
    database-platform: org.hibernate.dialect.H2Dialect
    show-sql: true

server:
  port: 8081

app:
  upload-dir: ./uploads-dev

security:
  jwt:
    cookie:
      domain: ""

# ==================================================
# ================= PROD (MariaDB) =================
# ==================================================
---
spring:
  config:
    activate:
      on-profile: prod

  datasource:
    url: jdbc:mariadb://${DB_HOST:localhost}:${DB_PORT:3306}/${DB_NAME:csr}?useUnicode=true&characterEncoding=utf8mb4&serverTimezone=UTC
    username: ${DB_USER:csr}
    password: ${DB_PASSWORD:csrpass}
    driver-class-name: org.mariadb.jdbc.Driver
    
    # HikariCP 커넥션 풀 설정
    hikari:
      # 최소 유휴 커넥션 수
      minimum-idle: 5
      # 최대 커넥션 풀 크기
      maximum-pool-size: 20
      # 커넥션 풀 이름
      pool-name: BlogHikariPool
      # 커넥션 타임아웃 (밀리초, 30초)
      connection-timeout: 30000
      # 유휴 커넥션 타임아웃 (밀리초, 10분)
      idle-timeout: 600000
      # 커넥션 최대 생명주기 (밀리초, 30분)
      max-lifetime: 1800000
      # 커넥션 테스트 쿼리
      connection-test-query: SELECT 1
      # 누수 감지 임계값 (밀리초, 0=비활성화)
      leak-detection-threshold: 60000
      # 자동 커밋
      auto-commit: true

  jpa:
    database-platform: org.hibernate.dialect.MariaDBDialect
    # 프로덕션에서는 ddl-auto를 validate로 변경 권장
    hibernate:
      ddl-auto: validate
    properties:
      hibernate:
        # 배치 크기 최적화
        jdbc:
          batch_size: 20
        # 쿼리 로그는 프로덕션에서 비활성화
        format_sql: false
    show-sql: false

# prod: 풀 로그로 문제 추적용 (필요 없으면 DEBUG → INFO 로 낮추기)
logging:
  level:
    com.zaxxer.hikari: DEBUG
    com.zaxxer.hikari.pool.HikariPool: DEBUG

server:
  port: 8080

security:
  jwt:
    cookie:
      domain: ITMOON.site
      secure: true

app:
  upload-dir: /var/myproject/uploads
